<html lang="zh">
<head>
    <title>playground!</title>
    <style>
        #editor {
            width: 80%;
            height: 410px;
        }

        .CodeMirror {
            height: 400px !important;
        }
    </style>
    <link rel="stylesheet" href="/static/css/app.css"/>
    <link rel="stylesheet" href="/static/lib/polipop/polipop.core.min.css"/>
    <link rel="stylesheet" href="/static/lib/polipop/polipop.default.min.css"/>
    <link rel="stylesheet" href="/static/lib/codemirror/codemirror.css"/>
    <link rel="stylesheet" href="/static/lib/codemirror/monokai.css"/>
</head>
<body>
<div style="max-width: 1200px;margin: 0 auto;">
    <div id="editor">
        <textarea id="code" name="code" style="display: none"></textarea>
    </div>
    <div id="toolbar" style="margin-bottom: 10px">
        <button class="button-24 button-24-green button-24-mid" role="button" onclick="codeRun()">Play</button>
        <button class="button-24 button-24-green button-24-mid" role="button" onclick="codeFormat()">格式化</button>
        <button class="button-24 button-24-green button-24-mid" role="button" id="zipCopy" onclick="codeCompress()">
            压缩&复制
        </button>
    </div>
</div>

<script src="/static/lib/codemirror/codemirror.js"></script>
<script src="/static/lib/codemirror/mode/javascript/javascript.js"></script>
<script src="/static/lib/format/base.js"></script>
<script src="/static/lib/format/jsformat.js"></script>
<script src="/static/lib/polipop/polipop.min.js"></script>
<script src="/static/js/clipboard.min.js"></script>
<script type="text/javascript">

    function codeRun() {
        //    TODO:使用虚拟机运行代码
    }

    function codeFormat() {
        var t = editor.getValue().replace(/^\s+/, "");
        if (t) {
            var e = 4
            var n = " ";
            return editor.setValue(js_beautify(t, e, n))
        }
        showPop('error', '格式化的代码值')
    }

    function codeCompress() {
        const e = editor.getValue().replace(/^\s+|\s+$/g, "");
        if ("" === e) {
            showPop('error', '压缩&复制')
        }
        var n = new Packer;
        var i = n.pack(e, 0, 0);
        editor.setValue(i)
    }

    new ClipboardJS("#zipCopy", {
        text: function (t) {
            let c = editor.getValue()
            if (c === "") {
                return ""
            }
            showPop('success', '压缩&复制')
            return editor.getValue()
        }
    })

    var codeArea = document.getElementById('code');
    var editor = CodeMirror.fromTextArea(codeArea, {
        mode: 'javascript',
        lineNumbers: true,
        indentUnit: 4,
        styleActiveLine: true,
        matchBrackets: true,
        lineWrapping: true,
        theme: 'monokai',
    });

    let polipop = new Polipop('mypolipop', {
        closer: false,
        position: 'center',
        layout: 'popups',
        insert: 'before',
        life: 2000,
        pool: 0,
        sticky: false,
        pauseOnHover: true
    });

    function showPop(type, msg) {
        if (type === 'success') {
            polipop.add({
                type: 'success',
                title: '提示',
                content: msg + '成功'
            });
        } else if (type === 'error') {
            polipop.add({
                type: 'error',
                title: '提示',
                content: msg + '失败'
            });
        }
    }
</script>
</body>